import { Component } from '@angular/core';
import { ApiService } from '../api.service';
import { Router } from '@angular/router';

@Component({
  selector: 'app-createexploitation',
  templateUrl: './createexploitation.component.html',
  styleUrls: ['./createexploitation.component.css']
})
export class CreateexploitationComponent {
exploitation = {
    nom: '',
    localisation: '',
    responsable: '',
    surfaceTotale: 0
  };

  message = '';
  errorMessage = '';

  constructor(private api: ApiService, private router: Router) { }

  onSubmit() {
    this.message = '';
    this.errorMessage = '';

    this.api.createExploitation(this.exploitation).subscribe({
      next: () => {
        this.message = 'Exploitation créée avec succès ! Redirection dans 2 secondes...';
        setTimeout(() => this.router.navigate(['/exploitations']), 2000);
      },
      error: (err) => {
        this.errorMessage = err.error?.message || 'Erreur lors de la création. Vérifie les champs ou la connexion.';
      }
    });
  }
}
