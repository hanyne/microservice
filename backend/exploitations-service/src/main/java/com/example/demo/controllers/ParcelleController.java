package com.example.demo.controllers;

import com.example.demo.entities.Parcelle;
import com.example.demo.services.ParcelleService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.*;

import java.util.List;
import java.util.Optional;

@RestController
@RequestMapping("/api/parcelles")
public class ParcelleController {

    @Autowired
    private ParcelleService parcelleService;

    @GetMapping
    public List<Parcelle> getAllParcelles() {
        return parcelleService.getAllParcelles();
    }

    @GetMapping("/{id}")
    public ResponseEntity<Parcelle> getParcelleById(@PathVariable Long id) {
        Optional<Parcelle> parcelle = parcelleService.getParcelleById(id);
        return parcelle.map(ResponseEntity::ok).orElseGet(() -> ResponseEntity.notFound().build());
    }

    @GetMapping("/exploitation/{exploitationId}")
    public List<Parcelle> getParcellesByExploitationId(@PathVariable Long exploitationId) {
        return parcelleService.getParcellesByExploitationId(exploitationId);
    }

    @PostMapping
    public Parcelle createParcelle(@RequestBody Parcelle parcelle) {
        return parcelleService.saveParcelle(parcelle);
    }

    @PutMapping("/{id}")
    public ResponseEntity<Parcelle> updateParcelle(@PathVariable Long id, @RequestBody Parcelle parcelleDetails) {
        Optional<Parcelle> parcelleOptional = parcelleService.getParcelleById(id);
        if (parcelleOptional.isEmpty()) {
            return ResponseEntity.notFound().build();
        }
        Parcelle parcelle = parcelleOptional.get();
        parcelle.setExploitation(parcelleDetails.getExploitation());
        parcelle.setCulture(parcelleDetails.getCulture());
        parcelle.setSurface(parcelleDetails.getSurface());
        parcelle.setEtat(parcelleDetails.getEtat());
        Parcelle updatedParcelle = parcelleService.saveParcelle(parcelle);
        return ResponseEntity.ok(updatedParcelle);
    }

    @DeleteMapping("/{id}")
    public ResponseEntity<Void> deleteParcelle(@PathVariable Long id) {
        parcelleService.deleteParcelle(id);
        return ResponseEntity.noContent().build();
    }
}